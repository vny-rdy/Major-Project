<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Traffic Congestion &amp; Route Suggestion</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <style>#map{height:90vh}</style>
</head>
<body>
  <h3>METR-LA Traffic Congestion Prediction</h3>
<label for="start">Start Node:</label>
<input id="start" type="number" value="0" placeholder="Start node ID">

<label for="end">End Node:</label>
<input id="end" type="number" value="50" placeholder="End node ID">

  <button onclick="route()">Suggest Route</button>
  <div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([34.05,-118.24],11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

fetch('/api/congestion').then(r=>r.json()).then(data=>{
  data.forEach(n=>{
    let c = n.congestion>70?'red':n.congestion>40?'orange':'green';
    L.circleMarker([n.lat,n.lon],{color:c,radius:6})
     .bindPopup("Node "+n.node_id+"<br>Congestion:"+n.congestion.toFixed(1))
     .addTo(map);
  });
});

function route(){
  let s=document.getElementById("start").value;
  let e=document.getElementById("end").value;
  fetch(`/api/route?start=${s}&end=${e}`)
    .then(r=>r.json()).then(d=>{
      L.polyline(d.coords,{color:'blue',weight:5}).addTo(map);
    });
}
</script>
</body>
</html>
